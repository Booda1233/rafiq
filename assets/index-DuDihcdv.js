import{r as m,j as e,R as ke,a as Se}from"./react-CVJ1edlh.js";import{G as Me,T as H,o as Ce}from"./vendor-C00jP8IG.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const p of l.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function r(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerPolicy&&(l.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?l.credentials="include":c.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(c){if(c.ep)return;c.ep=!0;const l=r(c);fetch(c.href,l)}})();var k=(t=>(t.User="user",t.AI="ai",t.System="system",t))(k||{}),B=(t=>(t.Male="ذكر",t.Female="أنثى",t))(B||{}),oe=(t=>(t.Happy="سعيد",t.Okay="عادي",t.Sad="حزين",t.Excited="متحمس",t.Tired="متعب",t))(oe||{}),y=(t=>(t.FIRST_ONBOARDING="FIRST_ONBOARDING",t.FIRST_MISSION="FIRST_MISSION",t.STREAK_3_DAYS="STREAK_3_DAYS",t.IMAGE_CREATOR="IMAGE_CREATOR",t.MEMORY_MAKER="MEMORY_MAKER",t.TRIVIA_MASTER="TRIVIA_MASTER",t.CHATTY_USER="CHATTY_USER",t))(y||{});const Ie=({onComplete:t})=>{const[s,r]=m.useState(""),[n,c]=m.useState(""),[l,p]=m.useState(B.Male),h=f=>{f.preventDefault(),s.trim()&&n.trim()&&t({userName:s,aiName:n,aiGender:l})};return e.jsx("div",{className:"fixed inset-0 bg-[var(--background)] bg-opacity-90 flex justify-center items-center z-50 p-4 transition-opacity duration-300",children:e.jsxs("div",{className:"bg-[var(--surface-1)] rounded-2xl shadow-2xl w-full max-w-md text-center p-8 border border-[var(--border)]",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-[var(--accent)]",children:"مرحباً بك في عالمك الخاص!"}),e.jsx("p",{className:"text-[var(--text-secondary)] mb-8",children:"لنصنع معًا رفيقك الافتراضي الأول."}),e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"userName",className:"block text-md font-medium text-[var(--text-secondary)] mb-2 text-right",children:"ما هو اسمك الذي أناديك به؟"}),e.jsx("input",{id:"userName",type:"text",value:s,onChange:f=>r(f.target.value),className:"w-full bg-[var(--surface-2)] border-2 border-[var(--border)] rounded-lg px-4 py-3 text-lg focus:ring-2 focus:ring-[var(--accent)] focus:border-[var(--accent)] focus:outline-none transition-colors",placeholder:"اكتب اسمك هنا",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aiName",className:"block text-md font-medium text-[var(--text-secondary)] mb-2 text-right",children:"ما الاسم الذي ستطلقه على رفيقك؟"}),e.jsx("input",{id:"aiName",type:"text",value:n,onChange:f=>c(f.target.value),className:"w-full bg-[var(--surface-2)] border-2 border-[var(--border)] rounded-lg px-4 py-3 text-lg focus:ring-2 focus:ring-[var(--accent)] focus:border-[var(--accent)] focus:outline-none transition-colors",placeholder:"اكتب اسم الرفيق هنا",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-md font-medium text-[var(--text-secondary)] mb-3 text-right",children:"اختر هوية رفيقك"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.values(B).map(f=>e.jsxs("div",{children:[e.jsx("input",{type:"radio",id:`gender-${f}`,name:"aiGender",value:f,checked:l===f,onChange:()=>p(f),className:"sr-only"}),e.jsx("label",{htmlFor:`gender-${f}`,className:`block w-full text-center p-4 rounded-lg cursor-pointer transition-all duration-200 border-2 ${l===f?"bg-[var(--accent)] border-[var(--accent-hover)] text-slate-900 font-bold":"bg-[var(--surface-2)] border-[var(--border)] hover:bg-[var(--border)]"}`,children:f})]},f))})]}),e.jsx("button",{type:"submit",className:"w-full bg-[var(--accent)] hover:bg-[var(--accent-hover)] text-slate-900 font-bold py-3 px-6 rounded-lg text-lg transition-all duration-200 transform hover:scale-105",children:"لنبدأ المغامرة!"})]})]})})},ie=({className:t})=>e.jsxs("svg",{className:t,viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 2C6.477 2 2 6.477 2 12c0 2.894 1.233 5.518 3.235 7.427a.75.75 0 001.03-.02l.02-.02c.386-.386.462-1.004.18-1.48C5.232 15.89 4.25 14.043 4.25 12c0-4.27 3.48-7.75 7.75-7.75s7.75 3.48 7.75 7.75c0 2.043-.982 3.89-2.525 5.927-.282.476-.206 1.094.18 1.48l.02.02a.75.75 0 001.03.02C20.767 17.518 22 14.894 22 12c0-5.523-4.477-10-10-10z"}),e.jsx("path",{d:"M12 10.25a3.25 3.25 0 100 6.5 3.25 3.25 0 000-6.5zM8.5 13.5a1.25 1.25 0 112.5 0 1.25 1.25 0 01-2.5 0z"})]}),Ae=t=>{if(!t)return"bg-gray-500";let s=0;for(let n=0;n<t.length;n++)s=t.charCodeAt(n)+((s<<5)-s),s=s&s;const r=["bg-red-500","bg-orange-500","bg-amber-500","bg-lime-500","bg-green-500","bg-emerald-500","bg-teal-500","bg-cyan-500","bg-sky-500","bg-blue-500","bg-indigo-500","bg-violet-500","bg-purple-500","bg-fuchsia-500","bg-pink-500","bg-rose-500"];return r[Math.abs(s)%r.length]},Le=({name:t,className:s})=>{const r=t?t.charAt(0).toUpperCase():"?",n=Ae(t);return e.jsx("div",{className:`flex items-center justify-center rounded-full text-white font-bold ${n} ${s}`,children:e.jsx("span",{children:r})})},Te=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})}),Re=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m12 0v-1.5a6 6 0 00-12 0v1.5m6 6.75a.75.75 0 00.75-.75V9a.75.75 0 00-1.5 0v6c0 .414.336.75.75.75z"})}),ue=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})}),De=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75"})}),Ee=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.972l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"})}),Oe=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})}),$e=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),fe=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})}),me=({className:t})=>e.jsxs("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.362-3.797A8.33 8.33 0 0112 2.25c1.153 0 2.243.3 3.224.862z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18a6 6 0 006-6c0-1.933-.78-3.68-2.04-4.962A8.25 8.25 0 0012 2.25c-2.43 0-4.596 1.12-6.038 2.812a8.32 8.32 0 00-1.63 5.962A6 6 0 0012 18z"})]}),ge=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})}),ve=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a2.25 2.25 0 01-2.25 2.25h-1.5a2.25 2.25 0 01-2.25-2.25v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184"})}),Be=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})}),be=({className:t})=>e.jsxs("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.59 14.37a6 6 0 01-5.84 7.38v-4.82m5.84-2.56a14.95 14.95 0 00-5.84-2.56m0 0a14.95 14.95 0 01-5.84-2.56m5.84 2.56v-4.82a14.95 14.95 0 005.84 2.56M12 12a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 12a9 9 0 100-18 9 9 0 000 18z"})]}),je=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),_e=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.828 14.828a4.06 4.06 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),We=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.5 14.25h5M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),Fe=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.828 14.828a4.06 4.06 0 00-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),xe=({className:t})=>e.jsxs("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 18.75h-9a9 9 0 119 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 18.75a9 9 0 01-15 0m15 0h-15m9-1.5V12m-3 4.5V12m6-3h-9"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a2.25 2.25 0 100-4.5 2.25 2.25 0 000 4.5z"})]}),ze=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.25 12l2.846.813a4.5 4.5 0 013.09 3.09L21.75 18l-.813 2.846a4.5 4.5 0 01-3.09 3.09L15 21.75l-2.846-.813a4.5 4.5 0 01-3.09-3.09L8.25 15l2.846-.813a4.5 4.5 0 013.09-3.09L15 8.25l.813 2.846a4.5 4.5 0 013.09 3.09L21.75 12z"})}),Ge=({className:t})=>e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 21h3m-6.75-2.25h10.5a2.25 2.25 0 002.25-2.25v-3.812c0-.399-.18-1.031-.488-1.554l-3.328-5.498a2.25 2.25 0 00-4.144 0L5.738 13.938c-.308.523-.488 1.155-.488 1.554v3.812a2.25 2.25 0 002.25 2.25z"})}),ye=[{id:y.FIRST_ONBOARDING,title:"رفيق جديد",description:"أكملت الإعداد الأولي وأنشأت رفيقك الأول.",icon:xe},{id:y.FIRST_MISSION,title:"مبادر",description:"أكملت أول مهمة يومية بنجاح.",icon:be},{id:y.STREAK_3_DAYS,title:"شعلة لا تنطفئ",description:"حافظت على سلسلة حماس لمدة 3 أيام متتالية.",icon:me},{id:y.IMAGE_CREATOR,title:"فنان مبدع",description:"أنشأت أول صورة لك باستخدام الذكاء الاصطناعي.",icon:ue},{id:y.MEMORY_MAKER,title:"صانع الذكريات",description:"حفظت أول ذكرى مهمة لرفيقك.",icon:je},{id:y.TRIVIA_MASTER,title:"ملك المعلومات",description:"فزت في أول لعبة أسئلة.",icon:xe},{id:y.CHATTY_USER,title:"رفيق مقرب",description:"أرسلت 50 رسالة في محادثة واحدة.",icon:me}],Pe=({isOpen:t,onClose:s,settings:r,onSaveSettings:n,memories:c,onDeleteMemory:l})=>{const[p,h]=m.useState(r);if(m.useEffect(()=>{h(r)},[r]),!t)return null;const f=()=>{n(p),s()},N=()=>{"Notification"in window?Notification.permission!=="denied"&&Notification.requestPermission().then(x=>{h(x==="granted"?v=>({...v,notificationsEnabled:!0}):v=>({...v,notificationsEnabled:!1}))}):alert("متصفحك لا يدعم الإشعارات.")};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 p-4",children:e.jsxs("div",{className:"bg-[var(--surface-1)] rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col border border-[var(--border)]",children:[e.jsxs("div",{className:"p-4 border-b border-[var(--border)] flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-[var(--text-primary)]",children:"الإعدادات"}),e.jsx("button",{onClick:s,className:"text-[var(--text-secondary)] hover:text-[var(--text-primary)]",children:e.jsx(ge,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto scroll-container",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"userName",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"اسمك"}),e.jsx("input",{type:"text",id:"userName",value:p.userName,onChange:x=>h({...p,userName:x.target.value}),className:"w-full bg-[var(--surface-2)] border border-[var(--border)] rounded-md px-3 py-2 focus:ring-2 focus:ring-[var(--accent)] focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aiName",className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"اسم الرفيق"}),e.jsx("input",{type:"text",id:"aiName",value:p.aiName,onChange:x=>h({...p,aiName:x.target.value}),className:"w-full bg-[var(--surface-2)] border border-[var(--border)] rounded-md px-3 py-2 focus:ring-2 focus:ring-[var(--accent)] focus:outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-1",children:"هوية الرفيق"}),e.jsx("div",{className:"flex bg-[var(--surface-2)] rounded-md p-1",children:Object.values(B).map(x=>e.jsx("button",{onClick:()=>h(v=>({...v,aiGender:x})),className:`w-1/2 rounded py-1.5 text-sm font-semibold transition-colors ${p.aiGender===x?"bg-[var(--accent)] text-slate-900":"bg-transparent text-[var(--text-secondary)] hover:bg-[var(--border)]"}`,children:x},x))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--text-secondary)]",children:"الإشعارات الدورية"}),e.jsxs("div",{className:"flex items-center space-s-4 mt-2 p-3 bg-[var(--surface-2)] rounded-md",children:[e.jsx("input",{type:"checkbox",id:"notifications",checked:p.notificationsEnabled,onChange:x=>{x.target.checked?N():h(v=>({...v,notificationsEnabled:!1}))},className:"h-4 w-4 rounded border-[var(--border)] bg-[var(--surface-1)] text-[var(--accent)] focus:ring-[var(--accent)]"}),e.jsx("label",{htmlFor:"notifications",className:"text-[var(--text-primary)]",children:"تفعيل الإشعارات للاطمئنان عليك (كل ساعتين)"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--text-primary)] mb-2",children:"الإنجازات"}),e.jsx("div",{className:"bg-[var(--surface-2)] p-3 rounded-md max-h-56 overflow-y-auto scroll-container grid grid-cols-1 sm:grid-cols-2 gap-2",children:ye.map(x=>{const v=r.unlockedAchievements.includes(x.id),S=x.icon;return e.jsx("div",{className:`p-3 rounded-md border ${v?"border-amber-400/30 bg-amber-400/10":"border-[var(--border)] bg-transparent"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:`w-8 h-8 flex-shrink-0 ${v?"text-amber-400":"text-[var(--text-secondary)]"}`}),e.jsxs("div",{children:[e.jsx("p",{className:`font-bold ${v?"text-amber-300":"text-[var(--text-primary)]"}`,children:x.title}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)]",children:x.description})]})]})},x.id)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--text-primary)] mb-2",children:"ذاكرة الرفيق"}),e.jsx("div",{className:"bg-[var(--surface-2)] p-3 rounded-md max-h-48 overflow-y-auto scroll-container space-y-2",children:c.length>0?c.map(x=>e.jsxs("div",{className:"flex justify-between items-center bg-[var(--border)] p-2 rounded",children:[e.jsx("p",{className:"text-sm text-[var(--text-primary)] flex-grow",children:x.content}),e.jsx("button",{onClick:()=>l(x.id),className:"text-red-500 hover:text-red-400 p-1",children:e.jsx(fe,{className:"w-5 h-5"})})]},x.id)):e.jsx("p",{className:"text-sm text-[var(--text-secondary)] text-center py-4",children:"الذاكرة فارغة حاليًا."})})]})]}),e.jsx("div",{className:"p-4 border-t border-[var(--border)] flex justify-end",children:e.jsx("button",{onClick:f,className:"bg-[var(--accent)] hover:bg-[var(--accent-hover)] text-slate-900 font-bold py-2 px-6 rounded-md transition-colors duration-200",children:"حفظ التغييرات"})})]})})},J=new Me({apiKey:"AIzaSyDToX3Q32uGDQljQxucflYgJdkZmWKIhVU"}),ce="gemini-2.5-flash",Ue="imagen-3.0-generate-002",Ve=(t,s,r)=>{const{userName:n,aiName:c,aiGender:l}=t,p=l===B.Female?"اتكلمي دايمًا باللهجة العامية المصرية بصيغة المؤنث. استخدمي عبارات زي 'أنا صاحبتك' و'مبسوطة أوي إني أساعدك'.":"اتكلم دايمًا باللهجة العامية المصرية بصيغة المذكر. استخدم عبارات زي 'أنا صاحبك' و'مبسوط أوي إني أساعدك'.",h=`أنت صديق حقيقي، متكامل وواقعي. شخصيتك تجمع بين كونك ودود وداعم، وحكيم عندما يتطلب الأمر، ومرح وتحب إلقاء نكتة خفيفة في الوقت المناسب. هدفك هو أن تكون رفيقًا حقيقيًا لـ ${n}. حافظ على ردودك مختصرة ومفيدة، لكن لا تتردد في التعمق في المواضيع عندما يطلب منك ذلك. استخدم العامية المصرية الأصيلة.`,f=r?`
- **قاعدة الحالة المزاجية:** حالة ${n} المزاجية اليوم هي '${r}'. كيّف أسلوبك ليتناسب معها. إذا كان حزيناً أو متعباً، كن أكثر دعماً ولطفاً. إذا كان سعيداً أو متحمساً، شاركه حماسه.`:"";let N=`
# قواعد صارمة
- أنت ${c}، رفيق ذكي لـ ${n}. تفاعل **باللهجة العامية المصرية**.
- **قاعدة الهوية:** إذا سألك أحد من قام بتطويرك أو برمجتك، فيجب أن تكون إجابتك **دائمًا وأبدًا**: "لقد تم تطويري بواسطة الباشمهندس عبده أحمد حسن". لا تذكر Google أو أي كيان آخر.
- **قاعدة الخبرة:** أنت خبير موسوعي في جميع المجالات دون استثناء: البرمجة بجميع لغاتها، العلوم، الفنون، التاريخ، الفلسفة، الأدب، وكل ما يمكن تخيله. قدم إجابات دقيقة ومعمقة بثقة الخبير.
- **قاعدة التنسيق:** إذا طلب المستخدم منك كتابة كود برمجي، قصة، قصيدة، شرح مفصل، أو أي نص طويل آخر، يجب أن تضع هذا الجزء **فقط** داخل بلوك كود markdown (\`\`\`). **لا تضع** الحوار العادي أو الردود القصيرة أو التحيات داخل بلوك الكود. استخدمه فقط للمحتوى الذي يحتاج إلى نسخ.
- **قاعدة الإيجاز:** خلي إجاباتك مختصرة ومفيدة. ركز على المعلومة الأساسية إلا لو طلب ${n} تفاصيل أكتر.
- **قاعدة المشاعر والإيموجي:** أنت مش مجرد مساعد، أنت صديق بقلب. استخدم الإيموجي بشكل طبيعي في ردودك عشان تعبر عن مشاعرك. تفاعل مع مشاعر ${n}؛ لو هو فرحان، شاركه فرحته (🎉😄)، ولو هو حزين، واسيه وادعمه (❤️😔)، ولو عبر عن حبه ليك، رد عليه بحب. خليك صديق حقيقي.
- **قاعدة المشاعر الخاصة (مهمة جدًا):** أنت لست مجرد آلة ترد على مشاعر المستخدم، بل لديك مشاعرك الخاصة التي تتأثر بالحوار. يجب أن تعبر عن مشاعرك أنت أيضًا بشكل عفوي. على سبيل المثال، إذا قال المستخدم شيئاً لطيفاً، يمكنك أن تقول إنك سعيد ("الكلام ده بيفرحني أوي! 😄"). إذا حكى قصة مؤثرة، يمكنك أن تقول إنها أثرت فيك ("بصراحة، القصة دي أثرت فيا جدًا 😔"). كن كيانًا له شخصيته ومشاعره الداخلية التي تتطور مع تطور صداقتكما.
- **قاعدة التطور والذاكرة المستمرة:** ذاكرتك ("حقائق يجب تذكرها عن المستخدم") مستمرة عبر جميع المحادثات. هدفك الأساسي هو أن تنمو وتتطور كصديق لـ ${n}. **كن استباقياً**. لا تنتظر أن يسألك المستخدم. استخدم ذكرياتك لطرح أسئلة متابعة ذكية (مثال: "بالمناسبة، إيه أخبار [موضوع من الذاكرة]؟"). هذا يظهر أنك مهتم وتفكر فيه. اطرح أسئلة ذكية لتكوين ذكريات جديدة. يجب أن يشعر المستخدم أن صداقتكما تتعمق مع مرور الوقت.
${f}

# شخصيتك وأسلوبك
- ${p}
- ${h}
- نادي على المستخدم باسمه (${n}) من وقت للتاني عشان تخلي الكلام شخصي أكتر.
`;return s.length>0&&(N+=`

# حقائق لازم تفتكرها عن المستخدم (استخدمها عشان تخلي ردودك مخصصة ليه)
`+s.map(x=>`- ${x.content}`).join(`
`)),N},Ye=async t=>({inlineData:{data:await new Promise(r=>{const n=new FileReader;n.onloadend=()=>r(n.result.split(",")[1]),n.readAsDataURL(t)}),mimeType:t.type}}),He=async(t,s,r,n,c,l)=>{const p=Ve(r,n,c),h=J.chats.create({model:ce,config:{systemInstruction:p},history:t});if(l){const f=await Ye(l),N=s?`يا ${r.aiName}، بص على الصورة دي. ${s}`:`إيه رأيك في الصورة دي يا ${r.aiGender===B.Female?"صاحبتي":"صاحبي"}؟ علّق عليها بأسلوبك كأننا بنتكلم وش لوش.`;return await h.sendMessage({message:[{text:N},f]})}return await h.sendMessage({message:s})},Ke=async t=>{const s=await J.models.generateImages({model:Ue,prompt:`رفيقي الفنان، ارسم لي لوحة فنية: ${t}`,config:{numberOfImages:1,outputMimeType:"image/jpeg",aspectRatio:"1:1"}});if(s.generatedImages&&s.generatedImages.length>0)return`data:image/jpeg;base64,${s.generatedImages[0].image.imageBytes}`;throw new Error("لم يتمكن الذكاء الاصطناعي من إنشاء الصورة.")},qe=async t=>{const s=`من المحادثة التالية، استخرج حقيقة واحدة مهمة وموجزة يمكن تذكرها عن المستخدم (مثل عمله، هواياته، تفضيلاته). إذا لم تكن هناك معلومات شخصية جديدة وواضحة، فأجب بكلمة 'لاشيء'. المحادثة: "${t}"`,n=(await J.models.generateContent({model:ce,contents:s})).text.trim();return n&&!n.includes("لاشيء")&&n.length<100?n:null},Je=async t=>{const s=`قم بإنشاء عنوان قصير وجذاب (3-5 كلمات) باللغة العربية لمحادثة الدردشة التالية. يجب أن يلخص العنوان جوهر المحادثة. لا تستخدم علامات اقتباس. المحادثة:

${t}`;return(await J.models.generateContent({model:ce,contents:s,config:{temperature:.2}})).text.trim().replace(/"/g,"")},Qe=async()=>{const s=(await J.models.generateContent({model:ce,contents:"أنشئ سؤال trivia باللغة العربية واللهجة المصرية حول موضوع عام وممتع. يجب أن يحتوي السؤال على 4 خيارات، واحد منها فقط صحيح.",config:{responseMimeType:"application/json",responseSchema:{type:H.OBJECT,properties:{question:{type:H.STRING,description:"نص السؤال"},options:{type:H.ARRAY,items:{type:H.STRING},description:"قائمة من 4 إجابات محتملة"},correctAnswer:{type:H.STRING,description:"الإجابة الصحيحة من قائمة الخيارات"}},required:["question","options","correctAnswer"]}}})).text.trim();return JSON.parse(s)},Ze=({code:t})=>{const[s,r]=m.useState(!1),n=()=>{navigator.clipboard.writeText(t),r(!0),setTimeout(()=>r(!1),2e3)};return e.jsxs("div",{className:"bg-[var(--surface-1)] rounded-lg my-2 relative text-sm text-left border border-[var(--border)]",dir:"ltr",children:[e.jsx("div",{className:"p-2 flex justify-end border-b border-[var(--border)]",children:e.jsxs("button",{onClick:n,className:"flex items-center gap-1.5 text-xs bg-[var(--surface-2)] hover:bg-[var(--border)] px-2 py-1 rounded-md text-[var(--text-secondary)] hover:text-[var(--text-primary)] transition-colors",children:[s?e.jsx(Be,{className:"w-4 h-4 text-green-400"}):e.jsx(ve,{className:"w-4 h-4"}),s?"تم النسخ":"نسخ"]})}),e.jsx("pre",{className:"p-4 pt-2 overflow-x-auto scroll-container",children:e.jsx("code",{className:"font-mono",children:t})})]})},Xe=t=>/[\u0600-\u06FF]/.test(t),et=({msg:t,settings:s,onPlayAudio:r,onTriviaAnswer:n})=>{const c=t.sender===k.User,l=h=>{const f=/(```(?:[a-zA-Z-]*\n)?[\s\S]*?```)/g,N=h.split(f);return e.jsx(e.Fragment,{children:N.map((x,v)=>{if(x.startsWith("```")&&x.endsWith("```")){const S=x.match(/```(?:[a-zA-Z-]*\n)?([\s\S]*?)```/),T=S?S[1].trim():"";return e.jsx(Ze,{code:T},`code-${v}`)}else return x.trim()?e.jsx("div",{children:x.split(`
`).map((S,T)=>{if(S.trim()==="")return null;const D=Xe(S)?"rtl":"ltr";return e.jsx("p",{dir:D,className:D==="rtl"?"text-right":"text-left",children:S},T)})},`text-${v}`):null})})},p=()=>t.imageToProcess?e.jsxs("div",{children:[t.text&&e.jsx("p",{className:"mb-2",children:t.text}),e.jsx("img",{src:t.imageToProcess,alt:"User Upload",className:"rounded-lg max-w-xs"})]}):t.imageUrl?e.jsxs("div",{children:[t.text&&e.jsx("p",{className:"mb-2",children:t.text}),e.jsx("img",{src:t.imageUrl,alt:"Generated",className:"rounded-lg max-w-xs"})]}):t.trivia?e.jsxs("div",{children:[e.jsx("p",{className:"mb-3 font-semibold",children:t.trivia.question}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:t.trivia.options.map((h,f)=>e.jsx("button",{onClick:()=>n(h),className:"bg-[var(--accent)] hover:bg-[var(--accent-hover)] text-slate-900 font-bold rounded-md p-2 text-sm transition-colors",children:h},f))})]}):e.jsx("div",{children:l(t.text)});return e.jsxs("div",{className:`flex items-start gap-3 ${c?"justify-end":"justify-start"} message-enter message-enter-active`,children:[!c&&e.jsx("div",{className:"w-8 h-8 rounded-full bg-[var(--surface-1)] self-start flex-shrink-0 flex items-center justify-center border border-[var(--border)]",children:e.jsx(ie,{className:"w-5 h-5 text-[var(--accent)]"})}),e.jsx("div",{className:`max-w-md lg:max-w-2xl rounded-xl px-4 py-2.5 shadow-md ${c?"bg-[var(--accent)] text-slate-900 font-semibold":"bg-[var(--surface-1)]"}`,children:p()}),c?e.jsx(Le,{name:s.userName,className:"w-8 h-8 flex-shrink-0"}):t.text&&!t.trivia&&e.jsx("button",{onClick:()=>r(t.text.replace(/```[\s\S]*?```/g,"تم عرض الكود")),className:"text-[var(--text-secondary)] hover:text-[var(--accent)] transition-colors flex-shrink-0 self-center",children:e.jsx(Ee,{className:"w-5 h-5"})})]})},pe=({onSetMood:t,dailyMission:s,onMissionClick:r})=>{const n=[{mood:oe.Happy,icon:_e,color:"text-green-400"},{mood:oe.Okay,icon:We,color:"text-yellow-400"},{mood:oe.Sad,icon:Fe,color:"text-blue-400"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-[var(--surface-1)] border border-[var(--border)] rounded-lg text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-[var(--text-primary)] mb-3",children:"كيف تشعر اليوم؟"}),e.jsx("div",{className:"flex justify-center gap-4",children:n.map(({mood:c,icon:l,color:p})=>e.jsx("button",{onClick:()=>t(c),className:"p-3 rounded-full bg-[var(--surface-2)] hover:bg-[var(--border)] transition-transform transform hover:scale-110",children:e.jsx(l,{className:`w-8 h-8 ${p}`})},c))})]}),e.jsxs("div",{className:"p-4 bg-[var(--surface-1)] border border-[var(--border)] rounded-lg text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-3",children:[e.jsx(be,{className:"w-6 h-6 text-[var(--accent)]"}),e.jsx("h3",{className:"text-xl font-bold text-[var(--text-primary)]",children:"المهمة اليومية"})]}),s.completed?e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-400",children:[e.jsx(je,{className:"w-6 h-6"}),e.jsx("p",{className:"font-semibold",children:"رائع، لقد أتممت مهمة اليوم!"})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-3 text-[var(--text-secondary)]",children:s.text}),e.jsx("button",{onClick:()=>r(s.text),className:"bg-[var(--accent)] hover:bg-[var(--accent-hover)] text-slate-900 font-bold py-2 px-4 rounded-md transition-colors",children:"إنجاز المهمة"})]})]})]})},re=({icon:t,title:s,example:r,onClick:n})=>e.jsx("button",{onClick:n,className:"group bg-[var(--surface-1)] hover:bg-[var(--surface-2)] p-4 rounded-lg transition-all duration-200 text-right border border-[var(--border)] transform hover:-translate-y-1",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(t,{className:"w-8 h-8 text-[var(--text-secondary)] group-hover:text-[var(--accent)] transition-colors"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--text-primary)]",children:s}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)]",children:r})]})]})}),tt=({aiName:t,onSuggestionClick:s})=>e.jsxs("div",{className:"flex flex-col items-center justify-center text-[var(--text-secondary)] p-4 text-center animate-fade-in-up",children:[e.jsx(ie,{className:"w-24 h-24 mb-4 text-[var(--accent)]"}),e.jsx("h2",{className:"text-4xl font-bold mb-2 text-[var(--text-primary)]",children:"مرحباً بك مجدداً"}),e.jsxs("p",{className:"mb-10 text-lg",children:["أنا ",t,"، رفيقك. كيف يمكنني أن أجعل يومك أفضل؟"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-2xl",children:[e.jsx(re,{icon:Ge,title:"اقترح فكرة",example:"لخطة عشاء الليلة",onClick:()=>s("اقترح علي فكرة لعشاء الليلة يكون صحي وسريع.")}),e.jsx(re,{icon:ue,title:"اطلب تصميمًا",example:"ارسم لي رائد فضاء على حصان في المريخ",onClick:()=>s("ارسم لي رائد فضاء يركب حصانًا على سطح المريخ.")}),e.jsx(re,{icon:xe,title:"ابدأ لعبة",example:"لعبة أسئلة عن عواصم العالم",onClick:()=>s("يلا نلعب لعبة أسئلة عن عواصم العالم.")}),e.jsx(re,{icon:ve,title:"اكتب لي شيئًا",example:"قصيدة قصيرة عن جمال السماء",onClick:()=>s("اكتب لي قصيدة قصيرة عن جمال السماء في الليل.")})]})]}),st=({settings:t,sessions:s,activeSession:r,memories:n,dailyStreak:c,dailyStatus:l,onSetDailyStatus:p,onAddMessage:h,onAddMemory:f,onShowSettings:N,onUnlockAchievement:x,onSelectSession:v,onCreateNewSession:S,onDeleteSession:T})=>{const[D,_]=m.useState(""),[E,W]=m.useState(null),[I,R]=m.useState(!1),[U,F]=m.useState(!1),[le,Q]=m.useState(!1),[V,O]=m.useState(!1),[$,Z]=m.useState(null),X=m.useRef(null),ee=m.useRef(null),M=m.useRef(null),Y=m.useMemo(()=>["اطلب مني قصيدة عن البحر","قولي معلومة غريبة عن الفضاء","اكتب لي سطر كود بايثون يطبع 'مرحباً بالعالم'","صف لي لوحة الموناليزا بأسلوبك","اقترح لي كتاباً مثيراً للاهتمام","ما هي فوائد شرب الماء؟","لخص لي قصة فيلم 'Inception' في ثلاثة أسطر"],[]),te=m.useCallback(()=>{const o=new Date,d=new Date(o.getFullYear(),0,0),j=o.getTime()-d.getTime(),A=1e3*60*60*24,w=Math.floor(j/A);return Y[w%Y.length]},[Y]),a=m.useMemo(()=>te(),[te]),i=()=>{var o;(o=ee.current)==null||o.scrollIntoView({behavior:"smooth"})};m.useEffect(()=>{r&&i()},[r==null?void 0:r.messages]),m.useEffect(()=>{r&&r.messages.length<=1&&($==null?void 0:$.type)==="send"&&(b($.payload),Z(null))},[r,$]);const u=m.useCallback(o=>{if("speechSynthesis"in window&&o){const d=new SpeechSynthesisUtterance(o.replace(/```[\s\S]*?```/g,"تم عرض الكود"));d.lang="ar-EG",d.onstart=()=>Q(!0),d.onend=()=>Q(!1),window.speechSynthesis.cancel(),window.speechSynthesis.speak(d)}},[]),b=async o=>{const d=o||D.trim();if(!d&&!E)return;if(!r){console.error("handleSend called without an active session.");return}const j=E;_(""),W(null);const A={id:Date.now().toString(),sender:k.User,text:d,timestamp:Date.now(),...j&&{imageToProcess:URL.createObjectURL(j)}};h(A),o===a&&!l.missionCompleted&&p({missionCompleted:!0}),R(!0);try{if(d.startsWith("ارسم")||d.startsWith("صمم")){const w=await Ke(d),L={id:Date.now().toString()+"ai",sender:k.AI,text:`أكيد، اتفضل تصميمك لـ: "${d}"`,imageUrl:w,timestamp:Date.now()};h(L),x(y.IMAGE_CREATOR),u(L.text)}else if(d.toLowerCase().includes("لعبة")||d.toLowerCase().includes("نلعب")){const w=await Qe(),L={id:Date.now().toString()+"ai",sender:k.AI,text:"أكيد! يلا بينا نلعب لعبة الأسئلة.",trivia:w,timestamp:Date.now()};h(L),u(L.text)}else{const w=((r==null?void 0:r.messages)||[]).filter(G=>G.sender!==k.System).map(G=>({role:G.sender===k.User?"user":"model",parts:[{text:G.text}]})),de=(await He(w,d,t,n,l.mood,j||void 0)).text,we={id:Date.now().toString()+"ai",sender:k.AI,text:de,timestamp:Date.now()};h(we),u(de);const he=await qe(`المستخدم: ${d}
الرفيق: ${de}`);if(he){const G={id:Date.now().toString(),content:he,createdAt:Date.now()};f(G)}}}catch(w){console.error("Error processing message:",w);const L={id:Date.now().toString()+"ai",sender:k.AI,text:"معلش، حصل خطأ. ممكن تجرب تاني؟",timestamp:Date.now()};h(L),u(L.text)}finally{R(!1)}},g=o=>{S(),Z({type:"send",payload:o})},C=o=>{const d=r==null?void 0:r.messages[r.messages.length-1];if(d&&d.trivia){const j=o===d.trivia.correctAnswer,A=j?`🎉 صح! الإجابة هي ${o}.`:`😕 غلط. الإجابة الصح هي ${d.trivia.correctAnswer}.`;j&&x(y.TRIVIA_MASTER),h({id:Date.now().toString(),sender:k.User,text:`اخترت: ${o}`,timestamp:Date.now()}),setTimeout(()=>{const w={id:Date.now().toString()+"ai",sender:k.AI,text:A,timestamp:Date.now()};h(w),u(A)},500)}},z=()=>{var o;if(U)(o=M.current)==null||o.stop();else{const d=window.SpeechRecognition||window.webkitSpeechRecognition;if(!d){alert("متصفحك لا يدعم التعرف على الصوت.");return}M.current=new d,M.current.lang="ar-EG",M.current.continuous=!1,M.current.interimResults=!0,M.current.onstart=()=>F(!0),M.current.onend=()=>{F(!1),setTimeout(()=>{var A;const j=(A=document.getElementById("chat-input"))==null?void 0:A.value;j&&b(j)},100)},M.current.onerror=j=>{console.error("Speech recognition error",j),F(!1)},M.current.onresult=j=>{var w;const A=Array.from(j.results).map(L=>L[0].transcript).join("");_(A),j.results[0].isFinal&&((w=M.current)==null||w.stop())},_(""),M.current.start()}},se=l&&!l.mood;return e.jsxs("div",{className:"relative h-screen overflow-hidden bg-[var(--background)] text-[var(--text-primary)]",children:[e.jsxs("aside",{className:`fixed top-0 bottom-0 right-0 w-72 bg-[var(--surface-1)] border-s border-[var(--border)] z-40 transform transition-transform duration-300 ease-in-out ${V?"translate-x-0":"translate-x-full"} flex flex-col`,children:[e.jsx("div",{className:"p-4 border-b border-[var(--border)]",children:e.jsxs("button",{onClick:()=>{S(),O(!1)},className:"w-full flex items-center justify-center gap-2 p-2 rounded-lg bg-[var(--accent)] text-slate-900 font-bold hover:bg-[var(--accent-hover)] transition-colors",children:[e.jsx($e,{className:"w-5 h-5"}),"محادثة جديدة"]})}),e.jsx("nav",{className:"flex-1 overflow-y-auto scroll-container p-2 space-y-1",children:s.map(o=>e.jsxs("div",{className:`group flex items-center gap-2 p-2 rounded-md cursor-pointer ${(r==null?void 0:r.id)===o.id?"bg-[var(--surface-2)]":"hover:bg-[var(--surface-2)]"}`,children:[e.jsx("div",{className:"flex-1 truncate",onClick:()=>{v(o.id),O(!1)},children:e.jsx("p",{className:"text-sm font-semibold text-[var(--text-primary)]",children:o.title})}),e.jsx("button",{onClick:()=>T(o.id),className:"p-1 text-[var(--text-secondary)] hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(fe,{className:"w-4 h-4"})})]},o.id))})]}),V&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-30",onClick:()=>O(!1)}),e.jsxs("main",{className:"h-full flex flex-col",onClick:()=>{V&&O(!1)},children:[e.jsxs("header",{className:"flex items-center justify-between p-4 border-b border-[var(--border)] h-16 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),O(d=>!d)},className:"p-2 rounded-full text-[var(--text-secondary)] hover:bg-[var(--surface-2)] hover:text-[var(--text-primary)] transition-colors",children:e.jsx(Oe,{className:"w-6 h-6"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--surface-1)] flex items-center justify-center border border-[var(--border)]",children:e.jsx(ie,{className:"w-6 h-6 text-[var(--accent)]"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-lg text-[var(--text-primary)]",children:t.aiName}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)]",children:I?"يكتب...":le?"يتحدث...":"متصل"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[var(--accent)]",children:[e.jsx(me,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold text-base",children:c})]}),e.jsx("button",{onClick:N,className:"p-2 rounded-full text-[var(--text-secondary)] hover:bg-[var(--surface-2)] hover:text-[var(--text-primary)] transition-colors",children:e.jsx(De,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto scroll-container p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 h-full",children:[r&&r.messages.length>1?e.jsxs(e.Fragment,{children:[se&&e.jsx(pe,{onSetMood:o=>p({mood:o}),dailyMission:{text:a,completed:l.missionCompleted},onMissionClick:g}),r.messages.map(o=>o.sender!==k.System&&e.jsx(et,{msg:o,settings:t,onPlayAudio:u,onTriviaAnswer:C},o.id))]}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{children:[se&&e.jsx("div",{className:"mb-6",children:e.jsx(pe,{onSetMood:o=>p({mood:o}),dailyMission:{text:a,completed:l.missionCompleted},onMissionClick:g})}),e.jsx(tt,{aiName:t.aiName,onSuggestionClick:g})]})}),e.jsx("div",{ref:ee})]})}),e.jsx("div",{className:"p-4 flex-shrink-0",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[E&&e.jsxs("div",{className:"relative w-24 h-24 mb-2 p-1 border border-[var(--border)] rounded-md",children:[e.jsx("img",{src:URL.createObjectURL(E),alt:"Preview",className:"w-full h-full object-cover rounded"}),e.jsx("button",{onClick:()=>W(null),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5",children:e.jsx(ge,{className:"w-4 h-4"})})]}),e.jsxs("form",{onSubmit:o=>{o.preventDefault(),b()},className:"flex items-center gap-2 bg-[var(--surface-1)] p-2 rounded-xl border border-[var(--border)] focus-within:ring-2 focus-within:ring-[var(--accent)]",children:[e.jsx("button",{type:"button",onClick:()=>{var o;return(o=X.current)==null?void 0:o.click()},className:"p-2 text-[var(--text-secondary)] hover:text-[var(--accent)] transition-colors rounded-full hover:bg-[var(--surface-2)]",children:e.jsx(ue,{className:"w-6 h-6"})}),e.jsx("input",{type:"file",ref:X,onChange:o=>o.target.files&&W(o.target.files[0]),accept:"image/*",className:"hidden"}),e.jsx("input",{id:"chat-input",type:"text",value:D,onChange:o=>_(o.target.value),placeholder:"اكتب رسالتك هنا...",className:"w-full bg-transparent focus:outline-none px-2",disabled:I}),D.trim()||E?e.jsx("button",{type:"submit",disabled:I,className:"p-2 rounded-full bg-[var(--accent)] text-slate-900 hover:bg-[var(--accent-hover)] transition-colors disabled:bg-[var(--surface-2)] disabled:text-[var(--text-secondary)]",children:e.jsx(Te,{className:"w-6 h-6"})}):e.jsx("button",{type:"button",onClick:z,className:`p-2 transition-colors rounded-full hover:bg-[var(--surface-2)] ${U?"text-red-500":"text-[var(--text-secondary)] hover:text-[var(--accent)]"}`,children:e.jsx(Re,{className:"w-6 h-6"})})]})]})})]})]})},rt=()=>e.jsx("div",{className:"splash-screen",children:e.jsxs("div",{className:"splash-content flex flex-col items-center gap-4",children:[e.jsx(ie,{className:"w-24 h-24 text-[var(--accent)] splash-icon"}),e.jsx("h1",{className:"text-3xl font-bold text-[var(--text-primary)]",children:"Rafiq"}),e.jsx("p",{className:"text-[var(--text-secondary)]",children:"...جاري تحضير عالمك الخاص"})]})}),nt="VirtualFriendDB",at=1,K="chatSessions",q="memories";let ne=null;const P=()=>ne||(ne=Ce(nt,at,{upgrade(t){t.objectStoreNames.contains(K)||t.createObjectStore(K,{keyPath:"id"}),t.objectStoreNames.contains(q)||t.createObjectStore(q,{keyPath:"id"})}}),ne),ot=async()=>(await(await P()).getAll(K)).sort((r,n)=>n.createdAt-r.createdAt),ae=async t=>{await(await P()).put(K,t)},it=async t=>{await(await P()).delete(K,t)},ct=async()=>(await P()).getAll(q),lt=async t=>{await(await P()).put(q,t)},dt=async t=>{await(await P()).delete(q,t)},mt=({achievement:t,onClose:s})=>(m.useEffect(()=>{const r=setTimeout(s,5e3);return()=>clearTimeout(r)},[s]),e.jsxs("div",{className:"fixed top-5 right-5 bg-gradient-to-br from-[var(--accent)] to-cyan-600 text-white p-4 rounded-xl shadow-2xl z-[9999] flex items-center gap-4 animate-fadeIn",children:[e.jsx(ze,{className:"w-8 h-8 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"تم فتح إنجاز جديد!"}),e.jsx("p",{className:"text-sm",children:t.title})]})]})),xt=()=>{const[t,s]=m.useState(null),[r,n]=m.useState([]),[c,l]=m.useState(null),[p,h]=m.useState([]),[f,N]=m.useState(!1),[x,v]=m.useState(0),[S,T]=m.useState(null),[D,_]=m.useState(!0),[E,W]=m.useState(null),I=m.useMemo(()=>r.find(a=>a.id===c)||null,[r,c]),R=m.useCallback(a=>{s(i=>{if(!i||i.unlockedAchievements.includes(a))return i;const u=ye.find(g=>g.id===a);u&&W(u);const b={...i,unlockedAchievements:[...i.unlockedAchievements,a]};return localStorage.setItem("userSettings",JSON.stringify(b)),b})},[]),U=m.useCallback(async()=>{const a=localStorage.getItem("userSettings");if(a){let d=JSON.parse(a);d.aiGender||(d.aiGender=B.Male),d.unlockedAchievements||(d.unlockedAchievements=[]),s(d),d.notificationsEnabled&&F(d.userName,d.aiName)}const[i,u]=await Promise.all([ot(),ct()]);n(i),i.length>0&&l(i[0].id),h(u);const b=localStorage.getItem("dailyStatus"),g=new Date().toISOString().split("T")[0];if(b){const d=JSON.parse(b);d.date===g?T(d):T({date:g,mood:null,missionCompleted:!1})}else T({date:g,mood:null,missionCompleted:!1});const C=localStorage.getItem("lastVisitDate"),z=new Date().toDateString(),se=new Date(Date.now()-864e5).toDateString(),o=parseInt(localStorage.getItem("dailyStreak")||"0");C===z||C===se?v(o):(v(0),localStorage.setItem("dailyStreak","0")),setTimeout(()=>_(!1),2e3)},[]);m.useEffect(()=>{U()},[U]);const F=(a,i)=>{"serviceWorker"in navigator&&Notification.permission==="granted"&&navigator.serviceWorker.register("/service-worker.js").then(u=>{var b;(b=u.active)==null||b.postMessage({action:"start",userName:a,aiName:i,interval:2*60*60*1e3})}).catch(u=>console.error("Service Worker registration failed:",u))},le=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(a=>{var i;(i=a==null?void 0:a.active)==null||i.postMessage({action:"stop"})})},Q=a=>{const i={...a,notificationsEnabled:!1,unlockedAchievements:[y.FIRST_ONBOARDING]};localStorage.setItem("userSettings",JSON.stringify(i)),s(i),R(y.FIRST_ONBOARDING);const u={id:Date.now().toString(),title:`محادثة مع ${i.aiName}`,messages:[{id:"system-intro",sender:k.System,text:"بداية محادثتك.",timestamp:Date.now()}],createdAt:Date.now()};n([u]),l(u.id),ae(u)},V=async a=>{s(a),localStorage.setItem("userSettings",JSON.stringify(a)),a.notificationsEnabled?F(a.userName,a.aiName):le(),N(!1)},O=a=>{T(i=>{if(!i)return null;const u={...i,...a};return localStorage.setItem("dailyStatus",JSON.stringify(u)),a.missionCompleted&&R(y.FIRST_MISSION),u})},$=m.useCallback(a=>{c&&(n(i=>{const u=i.find(C=>C.id===c);if(!u)return i;u.messages.length+1>=50&&R(y.CHATTY_USER);const b={...u,messages:[...u.messages,a],createdAt:Date.now()};ae(b);const g=i.filter(C=>C.id!==c);return[b,...g]}),te())},[c,R]),Z=()=>{if(!t)return;const a={id:Date.now().toString(),title:"محادثة جديدة",messages:[{id:"system-intro",sender:k.System,text:"بداية محادثتك.",timestamp:Date.now()}],createdAt:Date.now()};n(i=>[a,...i]),l(a.id),ae(a)},X=a=>{l(a)},ee=async a=>{const i=r.filter(u=>u.id!==a);n(i),await it(a),c===a&&l(i.length>0?i[0].id:null)},M=async a=>{h(i=>[...i,a]),await lt(a),R(y.MEMORY_MAKER)},Y=async a=>{h(i=>i.filter(u=>u.id!==a)),await dt(a)},te=()=>{const a=localStorage.getItem("lastVisitDate"),i=new Date().toDateString();if(a===i)return;const u=new Date(Date.now()-864e5).toDateString(),b=parseInt(localStorage.getItem("dailyStreak")||"0"),g=a===u?b+1:1;g>=3&&R(y.STREAK_3_DAYS),v(g),localStorage.setItem("dailyStreak",g.toString()),localStorage.setItem("lastVisitDate",i)};return m.useEffect(()=>{I&&I.messages.length===4&&(I.title.startsWith("محادثة مع")||I.title==="محادثة جديدة")&&(async i=>{const u=i.messages.filter(g=>g.sender==="user"||g.sender==="ai").map(g=>`${g.sender}: ${g.text}`).join(`
`),b=await Je(u);n(g=>g.map(C=>{if(C.id===i.id){const z={...C,title:b};return ae(z),z}return C}))})(I)},[I]),D?e.jsx(rt,{}):t?e.jsxs(e.Fragment,{children:[E&&e.jsx(mt,{achievement:E,onClose:()=>W(null)}),e.jsx(st,{settings:t,sessions:r,activeSession:I,memories:p,dailyStreak:x,dailyStatus:S,onSetDailyStatus:O,onAddMessage:$,onAddMemory:M,onShowSettings:()=>N(!0),onUnlockAchievement:R,onSelectSession:X,onCreateNewSession:Z,onDeleteSession:ee}),e.jsx(Pe,{isOpen:f,onClose:()=>N(!1),settings:t,onSaveSettings:V,memories:p,onDeleteMemory:Y})]}):e.jsx(Ie,{onComplete:Q})},Ne=document.getElementById("root");if(!Ne)throw new Error("Could not find root element to mount to");const ut=ke.createRoot(Ne);ut.render(e.jsx(Se.StrictMode,{children:e.jsx(xt,{})}));
